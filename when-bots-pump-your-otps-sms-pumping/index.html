<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>When Bots Pump Your OTPs (SMS Pumping) - GSociety</title><meta name="description" content="A few years ago, I spent several months chasing a weird kind&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><style>#progress {
                    background: rgba(255,31,34,0.8);
                    position: fixed;
                    top: 0;
                    bottom: auto;
                    left: 0;
                    width: 0%;
                    height: 4px;
                    z-index: 1000;
                }</style><link rel="stylesheet" href="https://gsociety.fr/media/plugins/syntaxHighlighter/prism-beige.css"><link rel="stylesheet" href="https://gsociety.fr/media/plugins/syntaxHighlighter/prism-inline-color.css"><script async defer="defer" type="text/javascript" src="https://umami.guis.ch/script.js" data-website-id="362735fb-60a3-4a58-a64d-8d6e22e767b0" data-auto-track="true" data-do-not-track="true" data-cache="false"></script><link rel="canonical" href="https://gsociety.fr/when-bots-pump-your-otps-sms-pumping/"><link rel="alternate" type="application/atom+xml" href="https://gsociety.fr/feed.xml" title="GSociety - RSS"><link rel="alternate" type="application/json" href="https://gsociety.fr/feed.json" title="GSociety - JSON"><meta property="og:title" content="When Bots Pump Your OTPs (SMS Pumping)"><meta property="og:image" content="https://gsociety.fr/media/posts/7/ChatGPT-Image-16-oct.-2025-22_53_44.png"><meta property="og:image:width" content="1536"><meta property="og:image:height" content="1024"><meta property="og:site_name" content="GSociety"><meta property="og:description" content="A few years ago, I spent several months chasing a weird kind&hellip;"><meta property="og:url" content="https://gsociety.fr/when-bots-pump-your-otps-sms-pumping/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@Guisch_"><meta name="twitter:title" content="When Bots Pump Your OTPs (SMS Pumping)"><meta name="twitter:description" content="A few years ago, I spent several months chasing a weird kind&hellip;"><meta name="twitter:image" content="https://gsociety.fr/media/posts/7/ChatGPT-Image-16-oct.-2025-22_53_44.png"><link rel="preload" href="https://gsociety.fr/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://gsociety.fr/assets/css/style.css?v=e45c44ccde83874e1694741c41f3b133"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://gsociety.fr/when-bots-pump-your-otps-sms-pumping/"},"headline":"When Bots Pump Your OTPs (SMS Pumping)","datePublished":"2025-10-16T22:53+02:00","dateModified":"2025-10-17T00:22+02:00","image":{"@type":"ImageObject","url":"https://gsociety.fr/media/posts/7/ChatGPT-Image-16-oct.-2025-22_53_44.png","height":1024,"width":1536},"description":"A few years ago, I spent several months chasing a weird kind&hellip;","author":{"@type":"Person","name":"Guisch","url":"https://gsociety.fr/authors/guisch/"},"publisher":{"@type":"Organization","name":"Guisch"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><style>.extlink::after {
				background-color: currentColor;
				content: "";
				display: inline-block;
				height: 16px;
				margin-left: 5px;
				position: relative;
				top: 0px;
				width: 16px;
			}
		
					.extlink.extlink-icon-1::after {
						mask-image: url("data:image/svg+xml;utf8,<svg viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' xmlns='http://www.w3.org/2000/svg'><path d='M15 3h6v6'/><path d='M10 14 21 3'/><path d='M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'/></svg>");
						mask-repeat: no-repeat;
						mask-size: contain;
					}</style><style>.fi{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style><style>.li{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style></head><body class="post-template"><div id="theme-toggle" class="theme-toggle"><button id="toggle-theme" aria-label="Toggle Theme">🌙 / ☀️</button></div><script>document.addEventListener('DOMContentLoaded', function () {
  const toggleBtn = document.getElementById('toggle-theme');
  const htmlEl = document.documentElement;

  // Load saved preference
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') {
    htmlEl.classList.add('dark-mode');
  }

  toggleBtn.addEventListener('click', () => {
    const isDark = htmlEl.classList.toggle('dark-mode');
    const theme = isDark ? 'dark' : 'light';
    document.querySelector("iframe").contentWindow.document.querySelector("html").setAttribute("style", `color-scheme: ${theme};`);
    localStorage.setItem('theme', theme);
  });
});</script><div class="container"><div class="left-bar"><div class="left-bar__inner"><header class="header"><a class="logo" href="https://gsociety.fr/">GSociety</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle__box"><span class="navbar__toggle__inner">Menu</span></span></button><ul class="navbar__menu"><li><a class="tltp" href="https://gsociety.fr/" target="_self" aria-label="Home"><svg class="fi fi-home" width="24px" height="24px" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><use href="https://gsociety.fr/media/plugins/featherIcons/feather-sprite.svg#home"/></svg> <span>Home</span></a></li><li><a class="tltp" href="https://gsociety.fr/contact/" target="_self" aria-label="Contact"><svg class="fi fi-send" width="24px" height="24px" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><use href="https://gsociety.fr/media/plugins/featherIcons/feather-sprite.svg#send"/></svg> <span>Contact</span></a></li></ul></nav><a class="logo logo--atbottom" href="https://gsociety.fr/">GSociety</a></header></div></div><main class="main post"><article class="content"><figure class="content__featured-image content__featured-image--attop"><img src="https://gsociety.fr/media/posts/7/ChatGPT-Image-16-oct.-2025-22_53_44.png" srcset="https://gsociety.fr/media/posts/7/responsive/ChatGPT-Image-16-oct.-2025-22_53_44-xs.png 320w, https://gsociety.fr/media/posts/7/responsive/ChatGPT-Image-16-oct.-2025-22_53_44-sm.png 480w, https://gsociety.fr/media/posts/7/responsive/ChatGPT-Image-16-oct.-2025-22_53_44-md.png 768w, https://gsociety.fr/media/posts/7/responsive/ChatGPT-Image-16-oct.-2025-22_53_44-xl.png 1024w" sizes="(min-width: 1460px) 938px, (min-width: 1200px) calc(75.83vw - 154px), (min-width: 1120px) 938px, (min-width: 900px) calc(55vw + 333px), 100vw" loading="eager" height="1024" width="1536" alt="" aria-describedby="image-caption"></figure><div class="content__meta content__meta--attop"><div class="content__meta--attop__inner"><div class="content__maintag"><svg width="20" height="20" aria-hidden="true" focusable="false"><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#tag"/></svg> Published in <a href="https://gsociety.fr/tags/sms-pumping/" class="metadata__maintag">sms pumping</a></div></div></div><div class="main__inner"><div class="content__meta"><div class="content__author"><div><a href="https://gsociety.fr/authors/guisch/" class="content__author__name">Guisch</a><p>👋I’m Ghislain — aka Guisch. I’m a security engineer: I break things, I fix things, and in between, I run this blog. I started GSociety to share raw, real-world security stories: bugs that shouldn’t exist, tools I built to prove a point, design flaws hiding in plain sight. No fluff, no buzzwords — just lessons that stick. If it matters, breaks things, or makes me laugh, it’s here.</p></div></div><div class="content__date"><time datetime="2025-10-16T22:53">16 October 2025</time></div></div><header class="content__header"><h1 class="content__title">When Bots Pump Your OTPs (SMS Pumping)</h1><p class="content__lead">My Take on SMS Pumping Fraud</p></header><div class="content__entry"><div class="post__toc"><h3>Table of Contents</h3><ul><li><a href="#mcetoc_1j7nh6e7iqd">💬 The World Still Runs on SMS</a></li><li><a href="#mcetoc_1j7nh6e7iqe">🚨 The First Signs</a></li><li><a href="#mcetoc_1j7nh6e7iqf">🧱 What Didn’t Work</a></li><li><a href="#mcetoc_1j7nh6e7iqg">🧰 What Actually Worked</a></li><li><a href="#mcetoc_1j7nh6e7iqh">🧠 What I Learned</a></li><li><a href="#mcetoc_1j7nh6e7iqi">🔒 Why SMS Needs to Go</a></li><li><a href="#mcetoc_1j7nh6e7iqj">🏁 Closing thoughts</a></li></ul></div><p data-start="417" data-end="572">A few years ago, I spent several months chasing a weird kind of fraud — the kind that doesn’t steal data, doesn’t hack users, but still burns real money.</p><p data-start="574" data-end="604">It’s called <strong data-start="586" data-end="601">SMS Pumping</strong>.</p><p data-start="606" data-end="864">At first, it looked like just “spam traffic.” Then it became a full-time cat-and-mouse game between our defenses and whoever was behind it.<br data-start="745" data-end="748">Here’s the story, what we tried, what failed, and what I’d recommend if you’re running authentication systems today.</p><hr data-start="866" data-end="869"><h2 id="mcetoc_1j7nh6e7iqd" data-start="871" data-end="906">💬 The World Still Runs on SMS</h2><p data-start="908" data-end="965">Even in 2025, SMS is still everywhere.<br data-start="946" data-end="949">It’s used for:</p><ul data-start="966" data-end="1051"><li data-start="966" data-end="994"><p data-start="968" data-end="994">verifying phone numbers,</p></li><li data-start="966" data-end="994"><p data-start="968" data-end="994">logging in,</p></li><li data-start="1011" data-end="1051"><p data-start="1013" data-end="1051">and two-factor authentication (2FA).</p></li></ul><p data-start="1053" data-end="1216">It’s not perfect, but it’s easy: no app to install, no setup friction, works on every device.<br data-start="1146" data-end="1149">That simplicity is exactly what makes it popular — and exploitable.</p><p data-start="1218" data-end="1281">If you haven’t met <strong data-start="1237" data-end="1252">SMS Pumping</strong>, here’s the quick version:</p><p data-start="1283" data-end="1539">Fraudsters abuse your “send me an OTP” endpoint to trigger thousands of messages to phone numbers they control. Those numbers are <strong data-start="1413" data-end="1453">premium-rate or international routes</strong> that generate a profit when messages are sent.<br data-start="1500" data-end="1503">You pay the bill; they take the cut.</p><p data-start="1541" data-end="1882">As <a href="https://www.twilio.com/docs/verify/preventing-toll-fraud?utm_source=chatgpt.com" target="_blank" class="extlink extlink-icon-1" rel="nofollow noopener noreferrer">Twilio explains</a>, it’s a form of <strong data-start="1636" data-end="1675">Artificially Inflated Traffic (AIT)</strong> or <strong data-start="1679" data-end="1693">Toll Fraud</strong> — a telecom problem repackaged for web apps.<br data-start="1738" data-end="1741">Or, as <a href="https://datadome.co/fr/learning-center/quest-ce-que-le-sms-pumping-et-quel-est-son-impact-sur-votre-entreprise/" target="_blank" class="extlink extlink-icon-1" rel="nofollow noopener noreferrer">Datadome</a> puts it:</p><blockquote data-start="1883" data-end="2046"><p data-start="1885" data-end="2046">Bots exploit OTP systems by injecting premium or international numbers into signup forms, creating massive artificial SMS volumes — and revenue for someone else.</p></blockquote><p data-start="2048" data-end="2131">No data breach, no ransomware, just your infrastructure quietly working <em data-start="2120" data-end="2130">for them</em>.</p><hr data-start="2133" data-end="2136"><h2 id="mcetoc_1j7nh6e7iqe" data-start="2138" data-end="2161">🚨 The First Signs</h2><p data-start="2163" data-end="2419">It started subtly. SMS verifications were fine one day, then slightly up the next.<br data-start="2245" data-end="2248">Soon, the metrics showed an order-of-magnitude increase in OTP requests.<br data-start="2320" data-end="2323">Nothing else had changed — no marketing campaign, no new feature rollout, no real user growth.</p><p data-start="2421" data-end="2463">The pattern was clear only when zoomed in:</p><ul data-start="2464" data-end="2633"><li data-start="2464" data-end="2528"><p data-start="2466" data-end="2528">Many numbers followed each other sequentially (like blocks).</p></li><li data-start="2529" data-end="2575"><p data-start="2531" data-end="2575">Most of them never completed verification.</p></li><li data-start="2576" data-end="2633"><p data-start="2578" data-end="2633">Traffic looked “normal enough” to pass basic filters.</p></li></ul><p data-start="2635" data-end="2837">It wasn’t always a single big spike. It was distributed, blended into normal usage.<br data-start="2711" data-end="2714">That’s what makes SMS Pumping tricky — the goal is to make it <strong data-start="2776" data-end="2802">look like real traffic</strong>, so you don’t block it right away.</p><hr data-start="2839" data-end="2842"><h2 id="mcetoc_1j7nh6e7iqf" data-start="2844" data-end="2868">🧱 What Didn’t Work</h2><p data-start="2870" data-end="2973">We tried every textbook mitigation. Some slowed the fraud down for a while, but none fixed it for good.</p><p data-start="2975" data-end="3082"><strong data-start="2975" data-end="3000">1. IP or ASN blocking</strong><br data-start="3000" data-end="3003">Attackers use proxies and mobile networks. The IPs rotate constantly — useless.</p><p data-start="3084" data-end="3172"><strong data-start="3084" data-end="3113">2. Per-number rate limits</strong><br data-start="3113" data-end="3116">They just change numbers. Automation makes that trivial.</p><p data-start="3174" data-end="3354"><strong data-start="3174" data-end="3193">3. GeoIP-blocking</strong><br data-start="3193" data-end="3196">Cutting off “risky” regions helped for a while, but traffic always found a detour.<br data-start="3278" data-end="3281">Also, legitimate users in new regions occasionally got blocked — not fun.</p><p data-start="3356" data-end="3581"><strong data-start="3356" data-end="3385">4. Premium number filters</strong><br data-start="3385" data-end="3388">We used Google’s <a href="https://github.com/google/libphonenumber" target="_blank" class="extlink extlink-icon-1" rel="nofollow noopener noreferrer">libphonenumber</a> to reject known premium ranges.<br data-start="3495" data-end="3498">Worked in regulated markets, failed elsewhere. Metadata was incomplete or outdated.</p><hr data-start="3950" data-end="3953"><h2 id="mcetoc_1j7nh6e7iqg" data-start="3955" data-end="3983">🧰 What Actually Worked</h2><p data-start="3985" data-end="4116">After months of testing, we realized there’s no magic button.<br data-start="4046" data-end="4049">The only winning move was <strong data-start="4075" data-end="4115">layering multiple imperfect defenses</strong>.</p><p data-start="3985" data-end="4116"><strong data-start="3583" data-end="3614">✅ Captcha / bot challenges</strong><br data-start="3614" data-end="3617">We deployed <a href="https://cloud.google.com/recaptcha/docs/sms-fraud-detection" target="_blank" class="extlink extlink-icon-1" rel="nofollow noopener noreferrer">reCAPTCHA Enterprise with SMS Fraud protection</a>. We were among the first users to beta test the feature. It's not a perfect solution: false positives were mostly controlled, but still present sometimes. But it really helped stop fraud as we were shifting from the "easy-target" to the "target that requires effort". What ultimately drove the decision was mainly the cheap cost, and the fact that competitor (market leader) was also using it.<br>However, according to <a href="https://2captcha.com/p/recaptcha_enterprise" target="_blank" class="extlink extlink-icon-1" rel="nofollow noopener noreferrer">2captcha.com</a>, solving costs around $2 per thousand CAPTCHAs — and it's not enough to kill fraudsters business model.</p><p data-start="4118" data-end="4446"><strong data-start="4118" data-end="4150">✅ Prefix-based rate limiting</strong><br data-start="4150" data-end="4153">Instead of blocking individual numbers, we rate-limited based on the <strong data-start="4222" data-end="4232">prefix</strong> (first N digits).<br data-start="4250" data-end="4253">Fraudsters often used contiguous blocks, so this trapped whole batches.<br data-start="4324" data-end="4327">You just have to tune <em data-start="4349" data-end="4352">N</em> carefully — too broad and you block marketing campaigns, too narrow and you miss the pattern.</p><p data-start="4448" data-end="4674"><strong data-start="4448" data-end="4490">✅ Geo-permissions on your SMS provider</strong><br data-start="4490" data-end="4493">Use your provider’s “geo-permissions” (Twilio, MessageBird, etc.) to disable delivery in markets where you don’t operate.<br data-start="4614" data-end="4617">Every unnecessary region is free profit for someone else.</p><p data-start="4676" data-end="4755"><strong data-start="4676" data-end="4721">✅ Real-time monitoring and anomaly alerts</strong><br data-start="4721" data-end="4724">We built dashboards tracking:</p><ul data-start="4756" data-end="4885"><li data-start="4756" data-end="4793"><p data-start="4758" data-end="4793">OTPs requested vs. OTPs completed</p></li><li data-start="4794" data-end="4819"><p data-start="4796" data-end="4819">cost per SMS provider</p></li><li data-start="4820" data-end="4856"><p data-start="4822" data-end="4856">fraud risk scores from reCAPTCHA</p></li><li data-start="4857" data-end="4885"><p data-start="4859" data-end="4885">SMS per region over time</p></li></ul><p data-start="4887" data-end="4943">It’s manual work — but without a baseline, you’re blind.</p><p data-start="4945" data-end="5147"><strong data-start="4945" data-end="4973">✅ Alternative auth flows</strong><br data-start="4973" data-end="4976">Slowly push users toward <strong data-start="5006" data-end="5025">non-SMS methods</strong> when possible: email links, push notifications, WebAuthN, you name it.<br data-start="5086" data-end="5089">Reducing exposure is the best mitigation you’ll ever have.</p><hr data-start="5149" data-end="5152"><h2 id="mcetoc_1j7nh6e7iqh" data-start="5154" data-end="5176">🧠 What I Learned</h2><p data-start="5178" data-end="5208">A few lessons stuck with me:</p><ul data-start="5210" data-end="5682"><li data-start="5210" data-end="5328"><p data-start="5212" data-end="5328"><strong data-start="5212" data-end="5265">Fraudsters think in profit margins, not payloads.</strong><br data-start="5265" data-end="5268">If your SMS endpoint lets them earn, they’ll never stop.</p></li><li data-start="5330" data-end="5470"><p data-start="5332" data-end="5470"><strong data-start="5332" data-end="5385">Security teams need visibility, not just filters.</strong><br data-start="5385" data-end="5388">The hardest part wasn’t blocking — it was <em data-start="5432" data-end="5441">knowing</em> when we were under attack.</p></li><li data-start="5472" data-end="5582"><p data-start="5474" data-end="5582"><strong data-start="5474" data-end="5499">Every control decays.</strong><br data-start="5499" data-end="5502">Geo rules, blocklists, regexes — they rot the moment you stop updating them.</p></li><li data-start="5584" data-end="5682"><p data-start="5586" data-end="5682"><strong data-start="5586" data-end="5617">No tool beats common sense.</strong><br data-start="5617" data-end="5620">Automation helps, but understanding your traffic helps more.</p></li></ul><hr data-start="5684" data-end="5687"><h2 id="mcetoc_1j7nh6e7iqi" data-start="5689" data-end="5716">🔒 Why SMS Needs to Go</h2><p data-start="5718" data-end="5855">I get it — SMS is easy. But it’s also fragile.<br data-start="5764" data-end="5767">Between SIM swaps, interception, and pumping fraud, it’s more of a tax than a feature.</p><p data-start="5857" data-end="6010">Modern authentication standards like <strong data-start="5894" data-end="5906">WebAuthN</strong> and <strong data-start="5911" data-end="5923">passkeys</strong> exist for a reason.<br data-start="5943" data-end="5946">They’re phishing-resistant, cheap, and don’t depend on telcos.</p><p data-start="6012" data-end="6158">So, if your product still uses SMS 2FA and you have the choice — <strong data-start="6077" data-end="6111">favor no-SMS whenever possible</strong>.<br data-start="6112" data-end="6115">SMS should be a fallback, not your default.</p><hr data-start="6160" data-end="6163"><h2 id="mcetoc_1j7nh6e7iqj" data-start="6165" data-end="6203">🏁 Closing thoughts</h2><p data-start="6248" data-end="6412">SMS authentication isn’t going anywhere, but it’s time to stop pretending it’s secure. If you're still using it, at least make sure you’re not paying fraudsters for the privilege. When SMS is your only viable option, treat it as a security liability — not a solution.<br data-start="414" data-end="417">Layer your defenses, monitor relentlessly, and plan your exit strategy. If you can move away from SMS, do it. You'll save money — and sleep.</p><p> </p></div><footer class="content__footer"><div class="content__last-updated">This article was updated on <time datetime="2025-10-17T00:22">17 October 2025</time></div><div class="content__share"><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fgsociety.fr%2Fwhen-bots-pump-your-otps-sms-pumping%2F&amp;via=Guisch_&amp;text=When%20Bots%20Pump%20Your%20OTPs%20(SMS%20Pumping)" class="js-share twitter tltp tltp--top" aria-label="Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fgsociety.fr%2Fwhen-bots-pump-your-otps-sms-pumping%2F" class="js-share linkedin tltp tltp--top" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=When%20Bots%20Pump%20Your%20OTPs%20(SMS%20Pumping) https%3A%2F%2Fgsociety.fr%2Fwhen-bots-pump-your-otps-sms-pumping%2F" class="js-share whatsapp tltp tltp--top" title="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></footer></div></article><div class="content__section content__comments"><div class="main__inner"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="cusdis_thread" data-host="https://cusdis.guis.ch" data-app-id="4d084518-0342-4ab9-a857-a5bae886bac0" data-page-id="7" data-page-url="https://gsociety.fr/when-bots-pump-your-otps-sms-pumping/" data-page-title="When Bots Pump Your OTPs (SMS Pumping)" data-theme="auto"></div><noscript>Please enable JS to use the comments form.</noscript><div data-gdpr-group="gdpr-blocker/comments" id="cusdis-no-consent-info" style="background: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; color: #666; display: block; padding: 10px; text-align: center; width: 100%;">Comments are disabled because you have not consented to their use. You can change your cookie preferences through the 'cookie banner'.</div><script type="gdpr-blocker/comments">(function () {
				var d = document, s = d.createElement('script');
				s.src = 'https://cusdis.guis.ch/js/cusdis.es.js';
				s.defer = true;
				(d.head || d.body).appendChild(s);
			})();</script><script type="text/javascript">document.body.addEventListener('publii-cookie-banner-unblock-comments', function () {
				document.getElementById('cusdis-no-consent-info').style.display = 'none';
			}, false);</script></div></div></div></div><div class="content__section banner"><div class="main__inner"><script>window.addEventListener('load', function() {
    // Wait for the iframe to be loaded inside the .comment-wrapper div
    const checkIframeLoaded = setInterval(function() {
        if (document.querySelector(".comments-wrapper iframe")) {
            clearInterval(checkIframeLoaded); // Stop checking once iframe is found

            document.querySelector(".comments-wrapper iframe").style.height = document.querySelector(".comments-wrapper iframe").contentWindow.document.documentElement.scrollHeight + 'px';
        }
    }, 100); // Check every 100ms until iframe is found
});</script></div></div></main><div class="right-bar"><div class="right-bar__inner"><div class="sidebar"><section class="box tags"><h3 class="box__title">Recommended Topics</h3><ul class="tags__list"><li class="tags__item"><a href="https://gsociety.fr/tags/2fa/" class="btn btn--gray">2FA <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/appsec/" class="btn btn--gray">appsec <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/authentication/" class="btn btn--gray">authentication <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/bugbounty/" class="btn btn--gray">bugbounty <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/cybersecurity/" class="btn btn--gray">cybersecurity <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/disclosure/" class="btn btn--gray">disclosure <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/dns/" class="btn btn--gray">dns <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/email-security/" class="btn btn--gray">email security <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/fraud/" class="btn btn--gray">fraud <sup>(1)</sup></a></li><li class="tags__item"><a href="https://gsociety.fr/tags/githubpages/" class="btn btn--gray">githubpages <sup>(1)</sup></a></li></ul></section><section class="box newsletter"><h3 class="box__title">👀 Like this thinking?</h3><p class="newsletter__desc"><a href="/contact">Drop me a line</a>, no string attached</p></section><div class="box follow"><a href="https://x.com/Guisch_" class="tltp tltp--top" aria-label="Twitter"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.linkedin.com/in/gsociety/" class="tltp tltp--top" aria-label="LinkedIn"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://github.com/gsociety-fr" class="tltp tltp--top" aria-label="GitHub"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#github"/></svg> <span>GitHub</span> </a><a href="https://gsociety.fr/feed.xml" class="tltp tltp--top" aria-label="RSS"><svg><use xlink:href="https://gsociety.fr/assets/svg/svg-map.svg#RSS"/></svg> <span>RSS</span></a></div><div class="box copyright">GSociety 2025</div></div></div></div></div><script defer="defer" src="https://gsociety.fr/assets/js/scripts.min.js?v=b2d91bcadbf5db401b76eb5bb3092eb7"></script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script type="text/javascript">(() => {
    const name = 'outbound-link-click';
    document.querySelectorAll('a').forEach(a => {
      if (a.host !== window.location.host && !a.getAttribute('data-umami-event')) {
        a.setAttribute('data-umami-event', name);
        a.setAttribute('data-umami-event-url', a.href);
      }
    });
  })();</script><script>'use strict'; document.addEventListener('DOMContentLoaded', function() { var obfElements = document.querySelectorAll('.obfuscated-email'); obfElements.forEach(function(elem) { var dataType = elem.getAttribute('data-type'); var encodedEmail = elem.getAttribute('data-email'); var user = elem.getAttribute('data-user'); var domain = elem.getAttribute('data-domain'); var decodedEmail = ''; if (user && domain) { decodedEmail = user.split('').reverse().join('') + '@' + domain.split('').reverse().join(''); } else if (encodedEmail) { const parts = encodedEmail.split('@'); if (parts.length === 2) { decodedEmail = parts[0].split('').reverse().join('') + '@' + parts[1].split('').reverse().join(''); } else { decodedEmail = encodedEmail; } } if (dataType === 'mailto') { var originalText = elem.textContent.trim(); var a = document.createElement('a'); a.href = 'mailto:' + decodedEmail; if (elem.classList.length > 0) { a.className = elem.className; } if (originalText === '') { a.textContent = decodedEmail; } else { a.textContent = originalText; } elem.parentNode.replaceChild(a, elem); } else if (dataType === 'text') { var textNode = document.createTextNode(decodedEmail); elem.parentNode.replaceChild(textNode, elem); } }); });</script><script src="https://gsociety.fr/media/plugins/pagePrefetching/quicklink.umd.js"></script><script>window.addEventListener('load', () => {
					quicklink.listen({
						prerender: true,
						el: document.querySelector('body'),
						delay: 0,
						limit: Infinity,
						throttle: Infinity,
						timeout: 2000
					});
				});</script><script type="text/javascript">document.addEventListener("DOMContentLoaded", function() {
            if (window.location.pathname !== '/') {
            const progressBar = document.createElement('div');
            progressBar.id = 'progress';
            document.body.prepend(progressBar);
    
            let body = document.body,
                html = document.documentElement;
    
            let height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
    
            const setProgress = () => {
                let scrollFromTop = (document.documentElement.scrollTop || body.scrollTop) + html.clientHeight;
                let width = scrollFromTop / height * 100 + '%';
                progressBar.style.width = width;
            };
    
            window.addEventListener('scroll', setProgress);
            setProgress();
            }
        });</script><script defer="defer" src="https://gsociety.fr/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://gsociety.fr/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://gsociety.fr/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script defer="defer" src="https://gsociety.fr/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://gsociety.fr/privacy-policy/">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" aria-level="2" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="https://gsociety.fr/privacy-policy/">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title">Analytics (anonymized)</summary><p class="pcb__group__txt">Using Umami selfhosted to track the performance of the website</p></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Analytics (anonymized)</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title">Comments</summary><p class="pcb__group__txt">Using cusdis selfhosted to allow visitors to exchange and comment posts without requiring authentication to external service</p></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="comments" id="comments-cookies"> <label for="comments-cookies">Comments</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && (!cbConfig.initialLsState || cbConfig.initialLsState.indexOf(allowedGroup) === -1)) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('🍪 GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>